<p align="center">
    <img src="https://img.shields.io/badge/Score-100%2F100-success?style=for-the-badge&logo=42" alt="Score 100/100">
    <img src="https://img.shields.io/badge/Infrastructure-Docker-blue?style=for-the-badge&logo=docker" alt="Docker">
</p>

# ğŸ³ Inception - System Administration with Docker

This project focuses on virtualizing a complete web infrastructure using **Docker Compose** on **Debian Bookworm**. It features a multi-container architecture where each service is isolated and secured, complying with the strict requirements of the 42 curriculum.

## ğŸ—ï¸ Architecture

The infrastructure consists of three main services connected through a private bridge network named `inception`:

* **NGINX**: Acts as the single entry point, listening only on port 443 with TLS/SSL encryption.
* **WordPress**: A PHP-FPM powered container that runs the WordPress CMS (upstream processor for NGINX).
* **MariaDB**: The database management system storing the WordPress data.

## ğŸ› ï¸ Tech Stack

* **OS**: Debian Bookworm
* **Orchestration**: Docker Compose
* **Server**: NGINX (TLSv1.2/1.3)
* **Database**: MariaDB
* **CMS**: WordPress + PHP-FPM
* **Tools**: WP-CLI, OpenSSL, Make

## Getting Started

### 1. Prerequisites
The project is designed to run on a Linux environment. The `Makefile` automatically creates the necessary local volume directories on the host machine:
* `/home/jmaruffy/data/wordpress`
* `/home/jmaruffy/data/mariadb`

### 2. Secrets Management
This project uses **Docker Secrets** to securely handle sensitive data. Ensure you have a `secrets` folder in the parent directory (or update the path in `docker-compose.yml`) containing:
* `db_root_password.txt`: Password for the MariaDB root user.
* `db_password.txt`: Password for the WordPress database user.
* `credentials.txt`: Contains admin and user passwords for WordPress.

### 3. Usage
Use the provided `Makefile` to manage the project lifecycle:

* **Build and Start**:
    ```bash
    make
    ```
    *(Creates volumes, builds images, and starts containers in detached mode)*

* **Stop Infrastructure**:
    ```bash
    make down
    ```

* **Full Clean**:
    ```bash
    make fclean
    ```
    *(Stops containers, removes images, networks, and deletes volume data)*

## ğŸ”’ Configuration Details

### Security & SSL
* **Certificates**: A self-signed SSL certificate is automatically generated during the NGINX setup via `setup-ssl.sh`.
* **Access**: NGINX is the only container with exposed ports (443).
* **Isolation**: MariaDB and WordPress communicate exclusively inside the `inception` network.

### Database Setup
* **Initialization**: The `setup-db.sh` script initializes the database structure, creates the user defined in `.env`, and sets the root password securely.
* **Networking**: The server is configured to bind to `0.0.0.0` but remains protected by the Docker network firewall.

### WordPress Automation
* **Installation**: The `setup-wordpress.sh` script waits for the database to be healthy, then uses `wp-cli` to download, configure (`wp-config.php`), and install WordPress automatically.
* **Users**: It creates an admin account and a standard user account based on the secrets provided.

## ğŸ“‚ Project Structure

```text
.
â”œâ”€â”€ Makefile
â”œâ”€â”€ srcs
â”‚   â”œâ”€â”€ docker-compose.yml
â”‚   â”œâ”€â”€ .env
â”‚   â”œâ”€â”€ requirements
â”‚   â”‚   â”œâ”€â”€ mariadb
â”‚   â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”‚   â”œâ”€â”€ conf/
â”‚   â”‚   â”‚   â””â”€â”€ tools/setup-db.sh
â”‚   â”‚   â”œâ”€â”€ nginx
â”‚   â”‚   â”‚   â”œâ”€â”€ Dockerfile
â”‚   â”‚   â”‚   â”œâ”€â”€ conf/nginx.conf
â”‚   â”‚   â”‚   â””â”€â”€ tools/setup-ssl.sh
â”‚   â”‚   â””â”€â”€ wordpress
â”‚   â”‚       â”œâ”€â”€ Dockerfile
â”‚   â”‚       â””â”€â”€ tools/setup-wordpress.sh
â””â”€â”€ secrets/
```
## ğŸ§ª Testing & Verification

Once the infrastructure is running, use the following commands to verify that the services are correctly configured and isolated.

### 1. Global Status
Check that all containers are running and healthy:
```
docker ps
```
### 2. Test MariaDB
Verify database access and user creation.

* **Connect as root**:
```
docker exec -it mariadb mysql -u root -p
# Then enter the password contened secrets/db_root_password.txt
```
* **Connect with WordPress user**:
```
docker exec -it mariadb mysql -u <your_user> -p
# Then enter the password contened secrets/db_password.txt
```
* **Verify database content**:
When in the SQL prompt, execute:
```
SHOW DATABASES;
USE wordpress;
SHOW TABLES;
exit
```
### 3. Test NGINX & SSL
- NGINX is the only entry point. It must serve the site via HTTPS.

- Check SSL Certificate: Verify the subject of the certificate generated by the startup script:
```
docker exec -it nginx openssl x509 -in /etc/ssl/private/cert.pem -text -noout | grep "Subject:"
```

- Check HTTP Response:
```
curl -I -k [https://jmaruffy.42.fr](https://jmaruffy.42.fr)
```
- Check Database Connection from WP:
```
docker exec -it wordpress wp db check --allow-root --path=/var/www/html
```
- List Users:
```
docker exec -it wordpress wp user list --allow-root --path=/var/www/html
```

